{% extends 'backend/admin_base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4" style="font-weight:600; color:#333;">Add Category & Products</h2>

    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <!-- Add Brand Section -->
    <div class="card mb-4 p-3">
        <h4 class="mb-3">Add Brand</h4>
        <div class="row g-3 align-items-end">
            <div class="col-12 col-md-4">
                <label for="brandCategorySelect" class="form-label">Select Category</label>
                <select id="brandCategorySelect" class="form-select">
                    <option value="">Select Category</option>
                    {% for cat in categories %}
                        <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-12 col-md-5">
                <label for="brandNameInput" class="form-label">Brand Name</label>
                <input type="text" id="brandNameInput" class="form-control" placeholder="Enter Brand Name">
            </div>
            <div class="col-12 col-md-3 d-grid">
                <button type="button" id="saveBrandBtn" class="btn btn-success w-100">Save Brand</button>
            </div>
        </div>
    </div>

    <!-- Existing Brands -->
    <div class="card mb-4 p-3">
        <h4 class="mb-3">Existing Brands</h4>
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Category</th>
                        <th>Brand</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="brandList">
                    {% for b in brands %}
                    <tr data-id="{{ b.id }}">
                        <td>{{ b.category.name }}</td>
                        <td>{{ b.name }}</td>
                        <td>
                            <button class="btn btn-sm btn-warning editBrandBtn">Edit</button>
                            <button class="btn btn-sm btn-danger deleteBrandBtn">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Product Forms -->
    <div class="card mb-4 p-3">
        <h4 style="margin-bottom:15px;">Add Product</h4>

        <div class="mb-3">
            <label for="productCategorySelect" class="form-label">Select Category</label>
            <select id="productCategorySelect" class="form-select">
                <option value="">Select Category</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>

        
     <!-- Dynamic Category Forms -->
<div id="categoryForms">
    {% for cat in categories %}
    <form class="productForm" data-category="{{ cat.id }}" method="post" enctype="multipart/form-data" style="display:none;">
        {% csrf_token %}
        <input type="hidden" name="category" value="{{ cat.id }}">

        <div class="mb-3">
            <input type="text" name="product_name" class="form-control" placeholder="{{ cat.name }} Product Name" required>
        </div>

        {% if cat.name == "Mobile" %}
            <div class="mb-3"><input type="text" name="ram" class="form-control" placeholder="RAM"></div>
            <div class="mb-3"><input type="text" name="internal_storage" class="form-control" placeholder="Internal Storage"></div>
            <div class="mb-3"><input type="text" name="battery" class="form-control" placeholder="Battery Capacity"></div>
            <div class="mb-3"><input type="text" name="screen_size" class="form-control" placeholder="Screen Size"></div>
            <div class="mb-3"><input type="text" name="os" class="form-control" placeholder="Operating System"></div>
            <div class="mb-3"><input type="text" name="type" class="form-control" placeholder="Type"></div>
            <div class="mb-3"><input type="text" name="primary_camera" class="form-control" placeholder="Primary Camera"></div>
            <div class="mb-3"><input type="text" name="secondary_camera" class="form-control" placeholder="Secondary Camera"></div>
            <div class="mb-3"><input type="file" name="image" class="form-control" required></div>
            <div class="mb-3"><input type="number" name="price" class="form-control" placeholder="Price" required></div>
            <div class="mb-3"><input type="number" name="discount" class="form-control" placeholder="Discount (%)"></div>

            <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>



             <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>


        {% elif cat.name == "Computer Hardware" %}
            <div class="mb-3"><input type="text" name="brand" class="form-control" placeholder="Brand"></div>
            <div class="mb-3"><input type="number" name="price" class="form-control" placeholder="Price" required></div>
            <div class="mb-3"><input type="number" name="discount" class="form-control" placeholder="Discount (%)"></div>
            <div class="mb-3"><input type="file" name="image" class="form-control" required></div>

        {% elif cat.name == "Laptop" %}
            <div class="mb-3"><input type="text" name="processor" class="form-control" placeholder="Processor"></div>
            <div class="mb-3"><input type="text" name="brand" class="form-control" placeholder="Brand"></div>
            <div class="mb-3"><input type="text" name="ram_capacity" class="form-control" placeholder="RAM Capacity"></div>
            <div class="mb-3"><input type="text" name="screen_size" class="form-control" placeholder="Screen Size"></div>
            <div class="mb-3"><input type="text" name="processor_generation" class="form-control" placeholder="Processor Generation"></div>
            <div class="mb-3"><input type="text" name="ssd_capacity" class="form-control" placeholder="SSD Capacity"></div>
            <div class="mb-3"><input type="text" name="ram_type" class="form-control" placeholder="RAM Type"></div>
            <div class="mb-3"><input type="number" name="price" class="form-control" placeholder="Price" required></div>
            <div class="mb-3"><input type="number" name="discount" class="form-control" placeholder="Discount (%)"></div>
            <div class="mb-3"><input type="text" name="operating_system" class="form-control" placeholder="Operating System"></div>
            <div class="mb-3"><input type="text" name="weight" class="form-control" placeholder="Weight"></div>
            <div class="mb-3">
                <label for="touch_screen_{{ cat.id }}">Touch Screen</label>
                <select name="touch_screen" id="touch_screen_{{ cat.id }}" class="form-select">
                    <option value="">Select</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>

            
            <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>


             <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>
            

            <div class="mb-3"><input type="file" name="image" class="form-control" required></div>

        {% elif cat.name == "LED/OLED TV" %}
            <div class="mb-3"><input type="text" name="operating_system" class="form-control" placeholder="Operating System"></div>
            
            <div class="mb-3">
                <label for="smart_features_{{ cat.id }}">Smart Features</label>
                <select name="smart_features" id="smart_features_{{ cat.id }}" class="form-select" multiple>
                    <option value="WiFi">WiFi</option>
                    <option value="Bluetooth">Bluetooth</option>
                </select>
                <small class="text-muted">Use Ctrl (Windows) / Command (Mac) to select multiple features</small>
            </div>

            <div class="mb-3"><input type="number" name="usb_ports" class="form-control" placeholder="Number of USB Ports"></div>
            <div class="mb-3"><input type="number" name="price" class="form-control" placeholder="Price" required></div>
            <div class="mb-3"><input type="number" name="discount" class="form-control" placeholder="Discount (%)"></div>
            <div class="mb-3"><input type="file" name="image" class="form-control" required></div>

             
            <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>

            <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>

        {% endif %}

        {% if cat.name != "Computer Hardware" %}

        <div class="mb-3">
            <label for="brandSelect{{ cat.id }}">Select Brand</label>
            <select name="brand" id="brandSelect{{ cat.id }}" class="form-select" required>
                <option value="">Select Brand</option>
                {% for b in brands %}
                    <option value="{{ b.id }}">{{ b.name }}</option>
                {% endfor %}
            </select>


            <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>
        </div> 
         
            
        
        {% endif %}

        {% if cat.name == "Soundbar" %}
            
            <div class="mb-3">
                <input type="number" name="price" class="form-control" placeholder="Price" required>
            </div>
            <div class="mb-3">
                <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
            </div>

            

            <div class="mb-3">
                <label for="wired_wireless_{{ cat.id }}">Wired / Wireless</label>
                <select name="wired_wireless" id="wired_wireless_{{ cat.id }}" class="form-select">
                    <option value="">Select</option>
                    <option value="Wired">Wired</option>
                    <option value="Wireless">Wireless</option>
                    <option value="Wired & Wireless">Wired & Wireless</option>
                </select>
            </div>

            <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>

            <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>

        {% endif %}

        {% if cat.name == "Speaker" %}
    
    <div class="mb-3">
        <input type="number" name="price" class="form-control" placeholder="Price" required>
    </div>
    <div class="mb-3">
        <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
    </div>
   

    <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>


<!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>


   
{% endif %}

{% if cat.name == "Projector" %}

    <div class="mb-3">
        <input type="number" name="price" class="form-control" placeholder="Price" required>
    </div>
    <div class="mb-3">
        <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
    </div>
    <div class="mb-3">
        <label for="brandSelect{{ cat.id }}">Select Brand</label>
       
    </div>

    <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>

        <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>



{% endif %}

{% if cat.name == "Headphones" %}

    <div class="mb-3">
        <input type="number" name="price" class="form-control" placeholder="Price" required>
    </div>
    <div class="mb-3">
        <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
    </div>
    
    <div class="mb-3">
        <label for="color_{{ cat.id }}">Color</label>
        <select name="color" id="color_{{ cat.id }}" class="form-select">
            <option value="">Select Color</option>
            <option value="Black">Black</option>
            <option value="White">White</option>
            <option value="Red">Red</option>
            <option value="Blue">Blue</option>
        </select>
    </div>

    <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>

    <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>

    <div class="mb-3">
        <input type="text" name="compatible_with" class="form-control" placeholder="Compatible With (e.g. mobile, laptop, tablet)">
    </div>

{% endif %}

{% if cat.name == "Camera" %}

<!-- Price & Discount -->
<div class="mb-3">
    <input type="number" name="price" class="form-control" placeholder="Price (₹)" required>
</div>
<div class="mb-3">
    <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
</div>

    <!-- Felt Timer -->
    <div class="mb-3">
        <label>Felt Timer</label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="felt_timer" value="Yes" id="felt_timer_yes_{{ cat.id }}">
            <label class="form-check-label" for="felt_timer_yes_{{ cat.id }}">Yes</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="felt_timer" value="No" id="felt_timer_no_{{ cat.id }}">
            <label class="form-check-label" for="felt_timer_no_{{ cat.id }}">No</label>
        </div>
    </div>

    <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>


    <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>


    <!-- Mega Pixel -->
    <div class="mb-3">
        <label>Mega Pixel</label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="Below 6MP" id="mp1_{{ cat.id }}">
            <label class="form-check-label" for="mp1_{{ cat.id }}">Below 6MP</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="6 to 7.9MP" id="mp2_{{ cat.id }}">
            <label class="form-check-label" for="mp2_{{ cat.id }}">6 to 7.9 MP</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="8 to 9.9MP" id="mp3_{{ cat.id }}">
            <label class="form-check-label" for="mp3_{{ cat.id }}">8 to 9.9 MP</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="10 to 13.99MP" id="mp4_{{ cat.id }}">
            <label class="form-check-label" for="mp4_{{ cat.id }}">10 to 13.99 MP</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="14 to 15.99MP" id="mp5_{{ cat.id }}">
            <label class="form-check-label" for="mp5_{{ cat.id }}">14 to 15.99 MP</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="18 to 23.99MP" id="mp6_{{ cat.id }}">
            <label class="form-check-label" for="mp6_{{ cat.id }}">18 to 23.99 MP</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="mega_pixel" value="24MP & Above" id="mp7_{{ cat.id }}">
            <label class="form-check-label" for="mp7_{{ cat.id }}">24MP & Above</label>
        </div>
    </div>

    

    <!-- Battery -->
    <div class="mb-3">
        <label>Battery Type</label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="battery_type" value="AA Battery" id="bat1_{{ cat.id }}">
            <label class="form-check-label" for="bat1_{{ cat.id }}">AA Battery</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="battery_type" value="AA Rechargeable Battery" id="bat2_{{ cat.id }}">
            <label class="form-check-label" for="bat2_{{ cat.id }}">AA Rechargeable Battery</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="battery_type" value="AAA Battery" id="bat3_{{ cat.id }}">
            <label class="form-check-label" for="bat3_{{ cat.id }}">AAA Battery</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="battery_type" value="AAA Rechargeable Battery" id="bat4_{{ cat.id }}">
            <label class="form-check-label" for="bat4_{{ cat.id }}">AAA Rechargeable Battery</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="battery_type" value="Lithium Battery" id="bat5_{{ cat.id }}">
            <label class="form-check-label" for="bat5_{{ cat.id }}">Lithium Battery</label>
        </div>
    </div>

    <!-- Sensor Type -->
    <div class="mb-3">
        <label>Sensor Type</label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="sensor_type" value="BSICMOS" id="sensor1_{{ cat.id }}">
            <label class="form-check-label" for="sensor1_{{ cat.id }}">BSICMOS</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="sensor_type" value="CCD" id="sensor2_{{ cat.id }}">
            <label class="form-check-label" for="sensor2_{{ cat.id }}">CCD</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="sensor_type" value="CMOS" id="sensor3_{{ cat.id }}">
            <label class="form-check-label" for="sensor3_{{ cat.id }}">CMOS</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="sensor_type" value="MOS" id="sensor4_{{ cat.id }}">
            <label class="form-check-label" for="sensor4_{{ cat.id }}">MOS</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="sensor_type" value="NMOS" id="sensor5_{{ cat.id }}">
            <label class="form-check-label" for="sensor5_{{ cat.id }}">NMOS</label>
        </div>
    </div>
{% endif %}


{% if cat.name == "Smartwatch" %}
    <!-- Price & Discount -->
    <div class="mb-3">
        <input type="number" name="price" class="form-control" placeholder="Price (₹)" required>
    </div>
    <div class="mb-3">
        <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
    </div>

    <!-- Dial Shape (Multiple Checkboxes) -->
    <div class="mb-3">
        <label>Dial Shape</label><br>
        {% for value, label in dial_shapes %}
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="dial_shape" value="{{ value }}" id="dial_{{ value }}_{{ cat.id }}">
                <label class="form-check-label" for="dial_{{ value }}_{{ cat.id }}">{{ label }}</label>
            </div>
        {% endfor %}
    </div>

    <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>


    <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>


    <!-- Display Size -->
    <div class="mb-3">
        <input type="text" name="display_size" class="form-control" placeholder="Display Size">
    </div>

    <!-- Ideal For (Multiple Checkboxes) -->
    <div class="mb-3">
        <label>Ideal For</label><br>
        {% for value, label in ideal_for_options %}
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="ideal_for" value="{{ value }}" id="ideal_{{ value }}_{{ cat.id }}">
                <label class="form-check-label" for="ideal_{{ value }}_{{ cat.id }}">{{ label }}</label>
            </div>
        {% endfor %}
    </div>
{% endif %}

{% if cat.name == "WiFi Router" %}
    <!-- Price & Discount -->
    <div class="mb-3">
        <input type="number" name="price" class="form-control" placeholder="Price (₹)" required>
    </div>
    <div class="mb-3">
        <input type="number" name="discount" class="form-control" placeholder="Discount (%)">
    </div>

    <div class="mb-3">
    <label for="quantity" class="form-label">Quantity</label>
    <input type="number" name="quantity" id="quantity" class="form-control" placeholder="Enter Quantity" min="0" required>
</div>

    <!-- ✅ Dynamic Color Dropdown -->
            <div class="mb-3">
                <label class="form-label">Select Colors</label><br>
                    {% for color in colors %}
                <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="colors" id="color_{{ color.id }}" value="{{ color.name }}">
                    <label class="form-check-label" for="color_{{ color.id }}">{{ color.name }}</label>
                </div>
            {% endfor %}

        </div>


    <!-- Wireless Speed -->
    <div class="mb-3">
        <label>Wireless Speed</label><br>
        {% for speed in wireless_speeds %}
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="wireless_speed" value="{{ speed }}" id="speed_{{ speed }}_{{ cat.id }}">
            <label class="form-check-label" for="speed_{{ speed }}_{{ cat.id }}">{{ speed }} Mbps</label>
        </div>
        {% endfor %}
    </div>
{% endif %}




        


    <div class="mb-3"><input type="file" name="image" class="form-control" required></div>



        <button type="submit" name="product_submit" class="btn btn-success">Add Product</button>
    </form>
    {% endfor %}
</div>



    </div>
</div>

<script>
// CSRF token
function getCookie(name) {
    let cookieValue = null;
    if(document.cookie && document.cookie!==''){
        document.cookie.split(';').forEach(cookie=>{
            cookie = cookie.trim();
            if(cookie.startsWith(name+'=')) cookieValue = decodeURIComponent(cookie.substring(name.length+1));
        });
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');

// Brand Add/Edit/Delete Logic
const brandCategorySelect = document.getElementById('brandCategorySelect');
const brandNameInput = document.getElementById('brandNameInput');
const saveBrandBtn = document.getElementById('saveBrandBtn');
const brandList = document.getElementById('brandList');

saveBrandBtn.addEventListener('click', function(){
    const brandName = brandNameInput.value.trim();
    const categoryId = brandCategorySelect.value;
    if(!brandName) return alert('Enter brand name');
    if(!categoryId) return alert('Select category first');

    fetch("{% url 'add_brand_ajax' %}", {
        method:'POST',
        headers:{'Content-Type':'application/json','X-CSRFToken':csrftoken},
        body: JSON.stringify({name:brandName, category_id:parseInt(categoryId)})
    }).then(res=>res.json())
    .then(data=>{
        if(data.status==='success'){ alert('Brand added successfully!'); brandNameInput.value=''; }
        else if(data.status==='exists') alert('Brand already exists.');
        else alert('Error: '+data.message);
    });
});

// Populate Brands in Product Form
const productCategorySelect = document.getElementById('productCategorySelect');
const categoryForms = document.querySelectorAll('.productForm');

productCategorySelect.addEventListener('change', function(){
    const catId = this.value;
    categoryForms.forEach(f=>f.style.display='none');
    if(!catId) return;

    const formToShow = document.querySelector(`.productForm[data-category="${catId}"]`);
    if(formToShow) formToShow.style.display = 'block';

    // Fetch brands for this category
    fetch(`/ajax/get_brands/${catId}/`)
    .then(res=>res.json())
    .then(data=>{
        const brandSelect = formToShow.querySelector('select[name="brand"]');
        brandSelect.innerHTML = '<option value="">Select Brand</option>';
        data.brands.forEach(b=>{
            const option = document.createElement('option');
            option.value = b.id;
            option.text = b.name;
            brandSelect.appendChild(option);
        });
    });
});

// Edit/Delete Brand
brandList.addEventListener('click', function(e){
    const tr = e.target.closest('tr');
    if(!tr) return;
    const brandId = tr.getAttribute('data-id');

    if(e.target.classList.contains('editBrandBtn')){
        const currentText = tr.querySelectorAll('td')[1].textContent;
        const newName = prompt("Edit Brand Name:", currentText.trim());
        if(newName){
            fetch(`/ajax/edit_brand/${brandId}/`, {
                method:'POST',
                headers:{'Content-Type':'application/json','X-CSRFToken':csrftoken},
                body:JSON.stringify({name:newName})
            }).then(res=>res.json())
            .then(data=>{
                if(data.status==='success') tr.querySelectorAll('td')[1].textContent=data.name;
                else alert('Error updating brand');
            });
        }
    }

    if(e.target.classList.contains('deleteBrandBtn')){
        if(confirm('Are you sure to delete this brand?')){
            fetch(`/ajax/delete_brand/${brandId}/`, {
                method:'POST',
                headers:{'Content-Type':'application/json','X-CSRFToken':csrftoken}
            }).then(res=>res.json())
            .then(data=>{
                if(data.status==='success') tr.remove();
                else alert('Error deleting brand');
            });
        }
    }
});
</script>

<style>
.card { border-radius: 8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px; }
h2,h4 { font-family: Arial,sans-serif; }
.btn { min-width:120px; }
</style>
{% endblock %}















