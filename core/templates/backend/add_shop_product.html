{% extends 'backend/admin_base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 bg-white rounded-lg shadow-md">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Add Shop Product</h2>

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            <!-- Shop Product Name -->
            <div>
                <label for="shop_product_name" class="block mb-2 font-medium text-gray-700">Shop Product Name</label>
                <input type="text" name="shop_product_name" placeholder="Enter Shop Product Name" required
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <!-- Product Dropdown -->
            <div>
                <label for="product_name" class="block mb-2 font-medium text-gray-700">Select Product</label>
                <select name="product" id="product" required
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="">Select Category</option>
                    {% for product in products %}
                        <option value="{{ product.id }}">{{ product.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Brand Dropdown -->
            <div>
                <label for="brand_name" class="block mb-2 font-medium text-gray-700">Select Brand</label>
                <select name="brand" id="brand_name" required
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="">Select Brand</option>
                </select>
            </div>

            <!-- Price -->
            <div>
                <label for="price" class="block mb-2 font-medium text-gray-700">Price</label>
                <input type="number" name="price" placeholder="Enter Price" required
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <!-- Discount -->
            <div>
                <label for="discount" class="block mb-2 font-medium text-gray-700">Discount (%)</label>
                <input type="number" name="discount" placeholder="Enter Discount"
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <!-- Quantity -->
            <div>
                <label for="quantity" class="block mb-2 font-medium text-gray-700">Quantity</label>
                <input type="number" name="quantity" placeholder="Enter Quantity" required
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <!-- Product Image -->
            <div>
                <label for="image" class="block mb-2 font-medium text-gray-700">Product Image</label>
                <input type="file" name="image" required
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <!-- Colors Section -->
            <div class="col-span-full">
                <label class="block mb-2 font-medium text-gray-700">Select Colors</label>
                <div class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 border border-gray-200 rounded">
                    {% for color, hex in colors %}
                    <label class="flex items-center gap-2 bg-gray-100 rounded px-2 py-1 text-sm hover:bg-gray-200 cursor-pointer">
                        <input type="checkbox" name="colors" value="{{ color }}" id="color{{ forloop.counter }}"
                            class="form-checkbox h-4 w-4 text-blue-600">
                        <span class="inline-block w-4 h-4 rounded border border-gray-300" style="background-color: {{ hex }};"></span>
                        {{ color }}
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- Latest Launch & Best Deals -->
            <div class="col-span-full flex flex-wrap gap-6 items-center">
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="latest_launch" class="form-checkbox h-5 w-5 text-green-600">
                    <span class="font-medium text-gray-700">Add to Latest Launches</span>
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="best_deal" class="form-checkbox h-5 w-5 text-red-600">
                    <span class="font-medium text-gray-700">Add to Best Deals</span>
                </label>
            </div>

            <!-- Product Other Details -->
            <div class="col-span-full">
                <label class="block mb-2 font-medium text-gray-700">Product Other Details</label>
                <div id="details-wrapper" class="space-y-2">
                    <div class="flex gap-2">
                        <input type="text" name="detail_keys" placeholder="Detail Name (e.g. RAM)"
                            class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <input type="text" name="detail_values" placeholder="Detail Value (e.g. 8GB)"
                            class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>
                </div>
                <button type="button" id="add-detail"
                    class="mt-2 px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 text-sm">Add More Details</button>
            </div>

            <!-- Specifications Section -->
            <div class="col-span-full">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Specifications</h3>
                <div id="specs-wrapper" class="space-y-2 border p-3 rounded-md max-h-64 overflow-y-auto">
                    <div class="flex gap-2">
                        <input type="text" name="spec_keys" placeholder="Specification Name (e.g. RAM)"
                            class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <input type="text" name="spec_values" placeholder="Specification Value (e.g. 8GB)"
                            class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>
                </div>
                <button type="button" id="add-spec"
                    class="mt-2 px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 text-sm">Add More Specifications</button>
            </div>

            <!-- Product Descriptions Section -->
            <div class="col-span-full">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Product Descriptions</h3>
                <div id="descriptions-wrapper" class="space-y-4 border p-3 rounded-md max-h-96 overflow-y-auto">
                    <div class="description-item flex flex-col gap-2 border-b pb-2">
                        <input type="text" name="desc_titles" placeholder="Description Title"
                            class="border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <textarea name="desc_texts" placeholder="Description Text"
                            class="border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
                        <input type="file" name="desc_images" accept="image/*" class="border border-gray-300 rounded-md p-2">
                    </div>
                </div>
                <button type="button" id="add-description"
                    class="mt-2 px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 text-sm">Add More Description</button>
            </div>

        </div>

        <!-- Submit Button -->
        <div class="mt-4">
            <button type="submit"
                class="px-6 py-2 bg-green-600 text-white font-medium rounded hover:bg-green-700">Add Shop Product</button>
        </div>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script>
$(document).ready(function(){
    // Brand dropdown
    $('#product').change(function(){
        var product_id = $(this).val();
        if(product_id){
            $.ajax({
                url: "{% url 'get_brands_by_product' %}",
                data: {'product_id': product_id},
                dataType: 'json',
                success: function(data){
                    $('#brand_name').empty().append('<option value="">Select Brand</option>');
                    $.each(data.brands, function(key, value){
                        $('#brand_name').append('<option value="'+ value.id +'">'+ value.name +'</option>');
                    });
                }
            });
        } else {
            $('#brand_name').html('<option value="">Select Brand</option>');
        }
    });

    // Add more detail rows
    $('#add-detail').click(function(){
        $('#details-wrapper').append(`
            <div class="flex gap-2">
                <input type="text" name="detail_keys" placeholder="Detail Name"
                    class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <input type="text" name="detail_values" placeholder="Detail Value"
                    class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
        `);
    });

    // Add more specification rows
    $('#add-spec').click(function(){
        $('#specs-wrapper').append(`
            <div class="flex gap-2">
                <input type="text" name="spec_keys" placeholder="Specification Name"
                    class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <input type="text" name="spec_values" placeholder="Specification Value"
                    class="flex-1 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
        `);
    });

    // Add more description rows
    $('#add-description').click(function(){
        $('#descriptions-wrapper').append(`
            <div class="description-item flex flex-col gap-2 border-b pb-2">
                <input type="text" name="desc_titles" placeholder="Description Title" class="border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <textarea name="desc_texts" placeholder="Description Text" class="border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
                <input type="file" name="desc_images" accept="image/*" class="border border-gray-300 rounded-md p-2">
            </div>
        `);
    });

    // Auto-capitalize first letter before form submit
    $('form').on('submit', function() {
        $('input[name="detail_keys"], input[name="detail_values"]').each(function() {
            let value = $(this).val();
            if (value && isNaN(value)) { // agar value string hai
                $(this).val(value.charAt(0).toUpperCase() + value.slice(1));
            }
        });
    });
});
</script>
{% endblock %}
