{% extends 'core/base.html' %}
{% block content %}

<div class="container mx-auto mt-10 px-4 lg:flex lg:gap-8">

    <!-- Left Column: Payment Method + Payment Details -->
    <div class="lg:w-1/2 flex flex-col gap-6">

        <!-- Payment Method -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">Select Payment Method</h3>
            <div class="flex flex-col gap-3">
                <label class="payment-option">
                    <input type="radio" name="payment_method" value="upi" class="payment-radio">
                    <span>UPI</span>
                </label>

                <label class="payment-option">
                    <input type="radio" name="payment_method" value="card" class="payment-radio">
                    <span>Credit / Debit / ATM Card</span>
                </label>

                <label class="payment-option">
                    <input type="radio" name="payment_method" value="emi" class="payment-radio">
                    <span>EMI</span>
                </label>

                <label class="payment-option">
                    <input type="radio" name="payment_method" value="netbanking" class="payment-radio">
                    <span>Net Banking</span>
                </label>

                <label class="payment-option">
                    <input type="radio" name="payment_method" value="cod" class="payment-radio">
                    <span>Cash on Delivery (COD)</span>
                </label>
            </div>
        </div>

        <!-- Payment Form -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">Payment Details</h3>
            <div id="payment-form-container" class="bg-gray-50 p-4 rounded border border-gray-200">
                <p class="text-gray-500">Select a payment method to see the form.</p>
            </div>
        </div>

    </div>

    <!-- Right Column: Product / Order Summary -->
    <div class="lg:w-1/2">
        <div class="order-summary-card">
            <h4 class="summary-heading">Product Details</h4>

            <div class="summary-content">
                <!-- Product Image -->
                <div class="summary-image">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}">
                </div>

                <!-- Product Info -->
                <div class="summary-info">
                    <p><b>Product:</b> {{ product.name }}</p>

                    {% if selected_color %}
                    <p class="color-info">
                        <b>Color:</b>
                        <span class="color-circle" style="background-color:{{ selected_color }};"></span>
                        {{ selected_color }}
                    </p>
                    {% endif %}

                    <p><b>Quantity:</b> {{ cart_item.quantity|default:"1" }}</p>
                    <p class="total-amount">Total: â‚¹{{ discounted_price|floatformat:2 }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* ðŸŒ¸ Container */
.container {
    max-width: 1200px;
    margin: auto;
}

/* ðŸ’³ Payment Option Card */
label.payment-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    background-color: #f8fafc;
}
label.payment-option:hover {
    background-color: #e0f2fe;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.payment-radio {
    accent-color: #2563eb;
    width: 20px;
    height: 20px;
}

/* ðŸ’° Payment Form */
#payment-form-container form {
    background: #ffffff;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
#payment-form-container input,
#payment-form-container select {
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 8px 12px;
    width: 100%;
    margin-bottom: 10px;
    transition: 0.3s;
}
#payment-form-container input:focus,
#payment-form-container select:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
    outline: none;
}

/* ðŸ’³ Payment Button */
#payment-form-container button {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    font-weight: 600;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: linear-gradient(90deg, #2563eb, #1d4ed8);
    transition: all 0.3s ease;
}
#payment-form-container button:hover {
    background: linear-gradient(90deg, #1d4ed8, #2563eb);
    transform: scale(1.02);
}

/* ðŸ“¦ Order Summary Card Styling */
.order-summary-card {
    background-color: #f8fafc; 
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.08);
    margin-top: 10px;
}

.summary-heading {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 15px;
    border-bottom: 1px solid #cbd5e1;
    padding-bottom: 8px;
}

.summary-content {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}

.summary-image img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.summary-info p {
    margin: 6px 0;
    color: #334155;
    font-size: 1rem;
}

.color-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.color-circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid #cbd5e1;
}

.total-amount {
    margin-top: 10px;
    font-weight: 700;
    font-size: 1.2rem;
    color: #16a34a;
}

/* Responsive */
@media(max-width: 1024px){
    .lg\\:flex {
        flex-direction: column;
    }
    .lg\\:w-1\\/2 {
        width: 100%;
    }
}
</style>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
let selected_color = "{% autoescape off %}{{ selected_color|default:'' }}{% endautoescape %}";

$(document).ready(function(){

    function generateForm(method){
        let html = '';
        // Hidden inputs including selected_color
       const hiddenInputs = `
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <input type="hidden" name="selected_color" value="${selected_color}">  <!-- âœ… color -->
            <input type="hidden" name="payment_method" value="${method}">
        `;


        if(method === 'upi'){
            html = `
                <form method="POST">
                    {% csrf_token %}
                    ${hiddenInputs}
                    <div class="flex flex-col gap-4">
                        <label class="block font-medium">Enter UPI ID</label>
                        <input type="text" name="upi_id" placeholder="example@upi" class="w-full border rounded px-3 py-2">
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-2">
                            Pay â‚¹{{ discounted_price|floatformat:2 }}
                        </button>
                    </div>
                </form>
            `;
        }
        else if(method === 'card'){
            html = `
                <form method="POST">
                    {% csrf_token %}
                    ${hiddenInputs}
                    <div class="flex flex-col gap-4">
                        <label class="block font-medium">Card Number</label>
                        <input type="text" name="card_number" placeholder="XXXX-XXXX-XXXX-XXXX" class="w-full border rounded px-3 py-2">
                        <label class="block font-medium">Expiry Date</label>
                        <input type="text" name="expiry" placeholder="MM/YY" class="w-full border rounded px-3 py-2">
                        <label class="block font-medium">CVV</label>
                        <input type="text" name="cvv" placeholder="XXX" class="w-full border rounded px-3 py-2">
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-2">
                            Pay â‚¹{{ discounted_price|floatformat:2 }}
                        </button>
                    </div>
                </form>
            `;
        }
        else if(method === 'emi'){
            html = `
                <form method="POST">
                    {% csrf_token %}
                    ${hiddenInputs}
                    <div class="flex flex-col gap-4">
                        <label class="block font-medium">Select Bank for EMI</label>
                        <select name="emi_bank" class="w-full border rounded px-3 py-2">
                            <option>SBI BANK</option>
                            <option>HDFC BANK</option>
                            <option>ICICI BANK</option>
                            <option>AXIS BANK</option>
                            <option>KOTAK BANK</option>
                        </select>
                        <label class="block font-medium">Choose Tenure</label>
                        <select name="emi_tenure" class="w-full border rounded px-3 py-2">
                            <option>3 Months</option>
                            <option>6 Months</option>
                            <option>12 Months</option>
                        </select>
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-2">
                            Pay â‚¹{{ discounted_price|floatformat:2 }}
                        </button>
                    </div>
                </form>
            `;
        }
        else if(method === 'netbanking'){
            html = `
                <form method="POST">
                    {% csrf_token %}
                    ${hiddenInputs}
                    <div class="flex flex-col gap-4">
                        <label class="block font-medium">Select Bank</label>
                        <select name="bank_name" class="w-full border rounded px-3 py-2">
                            <option>SBI BANK</option>
                            <option>HDFC BANK</option>
                            <option>ICICI BANK</option>
                            <option>AXIS BANK</option>
                            <option>KOTAK BANK</option>
                        </select>
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-2">
                            Pay â‚¹{{ discounted_price|floatformat:2 }}
                        </button>
                    </div>
                </form>
            `;
        }
        else if(method === 'cod'){
            html = `
                <form method="POST">
                    {% csrf_token %}
                    ${hiddenInputs}
                    <div class="flex flex-col gap-4">
                        <p class="text-green-600 font-semibold">You have selected <b>Cash on Delivery</b>.</p>
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-2">
                            Confirm Order (â‚¹{{ discounted_price|floatformat:2 }})
                        </button>
                    </div>
                </form>
            `;
        }

        $('#payment-form-container').html(html);
    }

    $('.payment-radio').change(function(){
        generateForm($(this).val());
    });

    // Pre-select form if color & method already set
    const checkedMethod = $('.payment-radio:checked').val();
    if(checkedMethod){
        generateForm(checkedMethod);
    }

});
</script>

{% endblock %}
